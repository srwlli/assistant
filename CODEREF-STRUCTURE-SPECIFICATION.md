# CodeRef Directory Structure Specification

**Version:** 2.0.0
**Last Updated:** 2026-01-14
**Source:** `coderef-dashboard/packages/coderef-core/scripts/setup-coderef-dir/`

---

## Official Structure

### `.coderef/` (Hidden, Technical)

Hidden directory for technical outputs, reports, and exports generated by coderef tools.

```
.coderef/
├── reports/
│   └── complexity/          # Complexity analysis reports
├── diagrams/                # Dependency diagrams (Mermaid, Graphviz)
└── exports/                 # Exported data (JSON-LD, etc.)
```

**Purpose:**
- Store generated reports that shouldn't clutter the visible workspace
- Cache analysis results for performance
- Export data in various formats for external tools

---

### `coderef/` (Visible, Workflow)

Visible directory for human-managed workflows, documentation, and workorders.

```
coderef/
├── workorder/               # Active workorders (shared across all coderef projects)
│   └── {feature-name}/
│       ├── stub.json        # Required: Feature metadata
│       ├── plan.json        # Optional: Implementation plan (if promoted)
│       ├── context.json     # Optional: Requirements context (if promoted)
│       ├── communication.json  # Optional: Multi-agent handoff (if multi-agent)
│       └── DELIVERABLES.md  # Optional: Completion metrics (if complete)
│
├── archived/                # Completed/cancelled features
│   └── {feature-name}/      # Moved from workorder/ when done
│
├── standards/               # UI/UX/behavior standards
│   ├── ui-patterns.md
│   ├── behavior-patterns.md
│   └── ux-patterns.md
│
├── foundation-docs/         # Generated documentation
│   ├── README.md
│   ├── ARCHITECTURE.md
│   ├── API.md
│   ├── SCHEMA.md
│   └── COMPONENTS.md
│
├── documents/               # General documentation (non-generated)
│
├── resource/                # Resource sheets (element documentation)
│
├── user/                    # User-facing documentation
│   ├── index.html           # Documentation UI
│   └── *.html               # Help pages
│
├── notes/                   # Working notes (scratchpad)
│
├── sessions/                # Multi-agent session files
│   └── {session-id}/
│       ├── communication.json
│       └── instructions.json
│
└── reports/                 # Project assessment and analysis reports
    └── PROJECT-STATE-ASSESSMENT-{date}.md
```

---

## Directory Descriptions

### Core Workflow Directories

#### `workorder/`
- **Purpose:** Active workorders shared across all coderef projects
- **Scope:** Cross-project (orchestrator and project agents coordinate here)
- **Files:** stub.json (required), plan.json, context.json, communication.json, DELIVERABLES.md
- **Lifecycle:** Created → In Progress → Archived

#### `archived/`
- **Purpose:** Completed or cancelled features
- **Scope:** Historical record
- **When to archive:** Workorder status = complete/abandoned
- **Retention:** Permanent (for auditing and learning)

#### `standards/`
- **Purpose:** UI/UX/behavior patterns discovered from codebase
- **Scope:** Project-specific consistency rules
- **Generated by:** `establish_standards` MCP tool
- **Used by:** `audit_codebase`, `check_consistency` MCP tools

---

### Documentation Directories

#### `foundation-docs/`
- **Purpose:** Auto-generated project documentation
- **Scope:** Core architecture, API, schema, components
- **Generated by:** `generate_foundation_docs` MCP tool
- **Files:** README.md, ARCHITECTURE.md, API.md, SCHEMA.md, COMPONENTS.md
- **Frontmatter:** Required (UDS-compliant YAML)

#### `documents/`
- **Purpose:** General documentation (non-generated)
- **Scope:** Planning docs, design docs, ADRs
- **Files:** Markdown, text, diagrams
- **Frontmatter:** Optional

#### `resource/`
- **Purpose:** Resource sheets (element-level documentation)
- **Scope:** Components, functions, classes, hooks
- **Generated by:** `generate_resource_sheet` MCP tool
- **Naming:** `{ElementName}-RESOURCE-SHEET.md`
- **Frontmatter:** Required (snake_case YAML)

#### `user/`
- **Purpose:** User-facing documentation and UI
- **Scope:** End-user help, tutorials, guides
- **Files:** HTML documentation UI, assets, CSS
- **Examples:** coderef-commands.html, coderef-tools.html

---

### Working Directories

#### `notes/`
- **Purpose:** Scratchpad for working notes
- **Scope:** Informal, not tracked
- **Files:** Markdown notes, brain dumps
- **Frontmatter:** Not required

#### `sessions/`
- **Purpose:** Multi-agent session coordination
- **Scope:** Session-specific communication
- **Files:** communication.json, instructions.json
- **Generated by:** `/create-session` slash command

#### `reports/`
- **Purpose:** Project assessment and analysis reports
- **Scope:** High-level project state, portfolio assessments
- **Files:** PROJECT-STATE-ASSESSMENT-{date}.md, STATE-OF-THE-UNION-{date}.md
- **Generated by:** Project state assessment prompts
- **Frontmatter:** Optional

---

## Special Case: `working/` Directory

### Project-Specific Working Directory

Some projects (e.g., **Assistant orchestrator**) use a `coderef/working/` directory for project-specific stubs that haven't been promoted to the shared `workorder/` space.

**Purpose:**
- Capture ideas local to one project
- Staging area before promotion to shared workorder

**When to use:**
- Project is an orchestrator coordinating multiple projects
- Need to separate local ideas from delegated workorders

**Structure:**
```
coderef/working/              # PROJECT-SPECIFIC (e.g., Assistant only)
└── {feature-name}/
    └── stub.json             # Local stub, not yet promoted
```

**Note:** This is **not part of the official spec** but is an acceptable project-specific extension.

---

## Hidden Technical Directory

### `.coderef/`

#### `reports/complexity/`
- **Purpose:** Complexity analysis reports
- **Generated by:** `coderef_complexity` MCP tool
- **Format:** JSON, Markdown
- **Files:** complexity-report.json, function-complexity.md

#### `diagrams/`
- **Purpose:** Dependency and relationship diagrams
- **Generated by:** `coderef_diagram` MCP tool
- **Format:** Mermaid, Graphviz DOT
- **Files:** dependencies.mmd, call-graph.dot

#### `exports/`
- **Purpose:** Exported coderef data in various formats
- **Generated by:** `coderef_export` MCP tool
- **Format:** JSON, JSON-LD, Mermaid, DOT
- **Files:** index.json, graph.jsonld, entities.mmd

---

## Setup Script

### Creating the Structure

Use the official setup script from coderef-core:

```bash
# Navigate to project
cd C:\path\to\your\project

# Run setup script
python C:\path\to\coderef-dashboard\packages\coderef-core\scripts\setup-coderef-dir\setup_coderef_dirs.py .

# Or preview first (dry run)
python setup_coderef_dirs.py . --dry-run
```

### What the Script Does

- ✅ Creates `.coderef/` with 3 subdirectories
- ✅ Creates `coderef/` with 9 subdirectories
- ✅ Idempotent (safe to run multiple times)
- ✅ Skips existing directories
- ✅ No files created (directories only)

### Example Output

```
Setting up Coderef structure in: C:\Users\willh\Desktop\assistant

[CREATE] .coderef/
  [CREATE] .coderef/reports/complexity/
  [CREATE] .coderef/diagrams/
  [CREATE] .coderef/exports/
[EXISTS] coderef/
  [CREATE] coderef/workorder/
  [EXISTS] coderef/archived/
  [EXISTS] coderef/standards/
  [CREATE] coderef/foundation-docs/
  [CREATE] coderef/documents/
  [CREATE] coderef/resource/
  [EXISTS] coderef/user/
  [EXISTS] coderef/notes/
  [CREATE] coderef/sessions/
```

---

## Validation

### Standard Directory Checklist

Use this checklist to validate a project's coderef structure:

- [ ] `.coderef/` exists (hidden)
  - [ ] `.coderef/reports/complexity/`
  - [ ] `.coderef/diagrams/`
  - [ ] `.coderef/exports/`
- [ ] `coderef/` exists (visible)
  - [ ] `coderef/workorder/`
  - [ ] `coderef/archived/`
  - [ ] `coderef/standards/`
  - [ ] `coderef/foundation-docs/`
  - [ ] `coderef/documents/`
  - [ ] `coderef/resource/`
  - [ ] `coderef/user/`
  - [ ] `coderef/notes/`
  - [ ] `coderef/sessions/`
  - [ ] `coderef/reports/`

### Non-Standard Directories (Red Flags)

These directories indicate deviation from the official spec:

- ⚠️ `coderef/features/` - Use `workorder/` instead
- ⚠️ `coderef/resources-sheets/` - Typo, use `resource/`
- ⚠️ `coderef/working/` - Only valid if project-specific (e.g., Assistant)
- ⚠️ `coderef/workflows/` - Not in spec
- ⚠️ `coderef/knowledge/` - Not in spec
- ⚠️ `coderef/schemas/` - Use `.coderef/exports/` instead

---

## Migration Guide

### Consolidating Non-Standard Directories

If your project has non-standard directories, consolidate them:

1. **`features/` → `workorder/`**
   ```bash
   mv coderef/features/* coderef/workorder/
   rmdir coderef/features
   ```

2. **`resources-sheets/` → `resource/`**
   ```bash
   mv coderef/resources-sheets/* coderef/resource/
   rmdir coderef/resources-sheets
   ```

3. **`workflows/` → `documents/`**
   ```bash
   mv coderef/workflows/* coderef/documents/
   rmdir coderef/workflows
   ```

4. **`knowledge/` → `notes/` or `documents/`**
   ```bash
   mv coderef/knowledge/* coderef/notes/
   rmdir coderef/knowledge
   ```

5. **`schemas/` → `.coderef/exports/`**
   ```bash
   mv coderef/schemas/* .coderef/exports/
   rmdir coderef/schemas
   ```

---

## Best Practices

### Do's
- ✅ Use `workorder/` for active cross-project work
- ✅ Archive completed features promptly
- ✅ Generate foundation docs with `generate_foundation_docs`
- ✅ Add UDS frontmatter to all documentation
- ✅ Use resource sheets for element-level documentation
- ✅ Keep notes/ for informal scratchpad work

### Don'ts
- ❌ Don't create custom top-level directories
- ❌ Don't store generated files in `coderef/` (use `.coderef/`)
- ❌ Don't leave completed workorders in `workorder/`
- ❌ Don't mix project-specific stubs with shared workorders
- ❌ Don't skip frontmatter on foundation docs

---

## Related Documentation

- **Setup Script:** `coderef-dashboard/packages/coderef-core/scripts/setup-coderef-dir/`
- **Documentation Cleanup:** `prompts/documentation-cleanup.md`
- **UDS Standards:** Papertrail MCP schemas
- **MCP Tools:** `coderef-docs`, `coderef-workflow`, `coderef-context`

---

**Specification Version:** 2.0.0
**Maintained by:** CodeRef Core Team
**Last Updated:** 2026-01-14
