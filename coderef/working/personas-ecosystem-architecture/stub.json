{
  "stub_id": "STUB-055",
  "feature_name": "personas-ecosystem-architecture",
  "title": "Comprehensive Personas Ecosystem Architecture & Coderef Integration",
  "description": "Define and implement a unified persona system where all personas are aware of the coderef ecosystem (MCP servers, scanning tools, standards, patterns). Resolve architectural questions: Are personas standalone files? Context files? Wrapped with metadata? How do they reference external knowledge?",
  "category": "feature",
  "priority": "high",
  "status": "planning",
  "created_at": "2025-12-24T00:00:00Z",
  "scope": {
    "personas_involved": [
      "CodeRef Assistant (orchestrator)",
      "Lloyd (project execution agent)",
      "Ava (frontend specialist)",
      "Taylor (general purpose)",
      "Devon (project setup)",
      "Widget Architect (new - from STUB-054)",
      "Future specialized personas (API Designer, Backend Expert, etc.)"
    ],
    "architectural_questions": [
      "Are personas pure JSON files or wrapped with metadata?",
      "How do personas reference external knowledge vs embed it?",
      "Do we use a context file wrapper or inline context?",
      "What's the relationship between persona files and coderef data?",
      "How do we version and evolve personas over time?",
      "Should personas be discoverable/searchable by role and capability?"
    ],
    "ecosystem_awareness_needed": [
      "coderef-context: scanning, pattern detection, complexity analysis, coverage",
      "coderef-workflow: planning, task tracking, execution metrics",
      "coderef-docs: standards, best practices, foundation docs",
      "coderef-testing: test patterns, coverage requirements",
      "git-mcp: branch management, metrics, commit history",
      "claude-filesystem-mcp: file operations, archive management",
      "personas-mcp: persona management, activation, context loading"
    ]
  },
  "key_questions": {
    "architecture": [
      "Q: Should persona files be self-contained or reference-based?",
      "A: Likely reference-based (URLs/paths to coderef data), but needs spec",
      "",
      "Q: Do all personas need coderef ecosystem awareness?",
      "A: Different personas need different subsets (Widget Architect needs patterns, Lloyd needs all)",
      "",
      "Q: Should personas be versioned?",
      "A: Probably yes (v1.0, v2.0) to track evolution",
      "",
      "Q: How do we handle persona conflicts/overrides?",
      "A: Need precedence rules (local > project > global)"
    ],
    "implementation": [
      "Q: Should we wrap personas in a context envelope?",
      "A: Possibly - {persona: {...}, context: {...}, metadata: {...}}",
      "",
      "Q: Do personas live in personas-mcp or in project-specific folders?",
      "A: Both? Global personas + project-specific specializations?",
      "",
      "Q: How does Lloyd know which tools to use?",
      "A: Persona should reference available tools + projects should list their tools",
      "",
      "Q: Can personas inherit from other personas?",
      "A: Maybe - Widget Architect inherits from Frontend Specialist + adds widget knowledge"
    ]
  },
  "current_state_analysis": {
    "personas_today": {
      "CodeRef Assistant": {
        "location": "C:\\Users\\willh\\.mcp-servers\\personas-mcp\\personas\\base\\coderef-assistant.json",
        "version": "2.0.1",
        "awareness": "\u2705 Full coderef ecosystem (recently updated)",
        "structure": "Pure JSON, context embedded in system_prompt",
        "limitation": "Orchestrator-only, not specialized for execution"
      },
      "Lloyd": {
        "location": "Unknown - need to locate",
        "status": "\u274c Needs coderef ecosystem update",
        "awareness": "Partial (doesn't know about new MCP servers)",
        "need": "Update to reference coderef-context, coderef-workflow, etc."
      },
      "Ava": {
        "location": "C:\\Users\\willh\\.claude\\commands\\ava.md",
        "status": "\u274c Needs coderef ecosystem update",
        "awareness": "Frontend-focused, unaware of orchestration system",
        "need": "Add coderef patterns, standards, testing knowledge"
      },
      "Taylor": {
        "location": "Unknown - need to locate",
        "status": "\u274c Needs coderef ecosystem update",
        "awareness": "Generic, no specialization",
        "need": "Make versatile across projects with coderef awareness"
      },
      "Devon": {
        "location": "Unknown - need to locate",
        "status": "\u274c Needs coderef ecosystem update",
        "awareness": "Project setup focused, needs bootstrap knowledge",
        "need": "Add coderef folder structure, scaffolding, standards"
      }
    },
    "gaps": [
      "No consistent structure across personas",
      "Some personas embedded in .md files, others in .json",
      "No version tracking",
      "No context inheritance/composition",
      "No persona discovery mechanism",
      "Inconsistent ecosystem awareness"
    ]
  },
  "design_options": {
    "option_1_pure_json": {
      "name": "Pure JSON Personas (Current Approach)",
      "structure": "Single .json file with all context embedded",
      "pros": [
        "Simple, self-contained",
        "Easy to version",
        "Works with current personas-mcp"
      ],
      "cons": [
        "Duplication when sharing context",
        "Hard to update standards across personas",
        "Large files if including all knowledge"
      ],
      "best_for": "Static personas that don't change often"
    },
    "option_2_reference_based": {
      "name": "Reference-Based Personas (External Knowledge)",
      "structure": "Persona file references URLs/paths to coderef data",
      "example": {
        "name": "widget-architect",
        "context_sources": {
          "patterns": "coderef-context://patterns/widget-patterns",
          "standards": "coderef-context://standards/ui-standards",
          "examples": "coderef-context://examples/widgets",
          "workorders": "coderef-workflow://completed/widgets"
        }
      },
      "pros": [
        "Single source of truth",
        "Standards updates apply to all personas automatically",
        "Smaller files",
        "Dynamic - always fresh"
      ],
      "cons": [
        "Requires coderef-context to be available",
        "External dependencies",
        "More complex caching/loading"
      ],
      "best_for": "Specialized personas that need current knowledge"
    },
    "option_3_hybrid": {
      "name": "Hybrid: Persona + Context Wrapper",
      "structure": "Persona file + optional context.json for project-specific knowledge",
      "example": {
        "persona.json": "Global persona definition",
        "context.json": "Project-specific standards, patterns, workorders",
        "metadata.json": "Versioning, inheritance, timestamps"
      },
      "pros": [
        "Flexibility (global + local)",
        "Supports inheritance",
        "Clear separation of concerns",
        "Composable"
      ],
      "cons": [
        "More complex structure",
        "More files to manage",
        "Potential conflicts"
      ],
      "best_for": "Enterprise systems with global + project-specific customization"
    }
  },
  "recommended_approach": {
    "strategy": "Hybrid: Start simple (Option 1), evolve to reference-based (Option 2) as STUB-054 (Widget Architect) proves the value",
    "immediate_steps": [
      "Standardize all personas to consistent JSON structure",
      "Add 'version', 'updated_at', 'coderef_ecosystem' sections to all personas",
      "Update CodeRef Assistant (done), Lloyd, Ava, Taylor, Devon with ecosystem awareness",
      "Define context_sources section (references to coderef data)"
    ],
    "phase_2": [
      "After STUB-054 succeeds: Build context loader in personas-mcp",
      "Convert reference-based personas to automated context loading",
      "Support persona inheritance (Widget Architect extends Frontend Specialist)"
    ],
    "decision_points": [
      "After standardization: Do we need context files? (context.json per persona/project)",
      "After first specialized persona: Is reference-based approach worth the complexity?",
      "After 5+ personas: Should we implement persona inheritance?"
    ]
  },
  "specific_updates_needed": {
    "CodeRef Assistant": {
      "status": "\u2705 Complete (v2.0.1)",
      "last_updated": "2025-12-24",
      "next": "Use as template for other personas"
    },
    "Lloyd": {
      "status": "\u274c TODO",
      "location": "Need to find Lloyd persona file",
      "updates": [
        "Add coderef-context awareness (scanning, patterns, complexity)",
        "Add coderef-workflow awareness (planning, task tracking)",
        "Add git-mcp awareness (branch management, metrics)",
        "Add tooling knowledge (what tools available in each MCP)",
        "Update version to match ecosystem changes"
      ]
    },
    "Ava": {
      "status": "\u274c TODO",
      "location": "C:\\Users\\willh\\.claude\\commands\\ava.md (needs to be .json)",
      "updates": [
        "Convert from .md to .json (standardization)",
        "Add widget/UI pattern knowledge",
        "Add coderef-context reference (UI standards, patterns)",
        "Add testing patterns for frontend",
        "Link to Scriptboard project knowledge"
      ]
    },
    "Taylor": {
      "status": "\u274c TODO",
      "location": "Need to find Taylor persona file",
      "updates": [
        "Broaden beyond generic to coderef-aware",
        "Add awareness of all 6 MCP servers",
        "Add ability to route to specialized personas when needed",
        "Versatile across projects"
      ]
    },
    "Devon": {
      "status": "\u274c TODO",
      "location": "Need to find Devon persona file",
      "updates": [
        "Add project bootstrap knowledge",
        "Add coderef folder structure templates",
        "Add initial standards scaffolding",
        "Add git setup and workflow awareness"
      ]
    }
  },
  "deliverables": {
    "phase_1_standardization": [
      "Unified persona JSON schema (version, coderef_ecosystem, context_sources, etc.)",
      "Updated personas: CodeRef Assistant (\u2705), Lloyd (TODO), Ava (TODO), Taylor (TODO), Devon (TODO)",
      "Documented structure for future persona creation",
      "Context sources reference guide (how to link to coderef data)"
    ],
    "phase_2_specialization": [
      "Widget Architect persona (after STUB-054 Phase 1)",
      "Context loader in personas-mcp (if Phase 1 proves valuable)",
      "Persona inheritance system (if 5+ personas exist)",
      "Persona discovery/search mechanism"
    ]
  },
  "success_criteria": [
    "\u2705 All existing personas updated with coderef ecosystem awareness",
    "\u2705 Consistent JSON structure across all personas",
    "\u2705 Each persona knows which MCP tools it can use",
    "\u2705 Each persona references coderef data (patterns, standards, tools)",
    "\u2705 Personas can be discovered by role/capability",
    "\u2705 Version tracking in place",
    "\u2705 New personas (Widget Architect) follow standard structure",
    "\u2705 Clear template for creating future specialized personas"
  ],
  "related_stubs": [
    "STUB-054 (persona-role-context-system: Widget Architect proof-of-concept)"
  ],
  "related_projects": [
    "coderef-system",
    "personas-mcp"
  ],
  "next_action": "Find all persona files (Lloyd, Ava, Taylor, Devon locations), inventory current state, then design standardized structure for approval.",
  "created": "2025-12-29",
  "target_project": "coderef-docs"
}